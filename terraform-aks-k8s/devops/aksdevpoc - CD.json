{"source":8,"revision":1,"description":null,"createdBy":{"displayName":"Joe Campbell","url":"https://spsprodcus2.vssps.visualstudio.com/A5a6858c3-4eb7-4a0c-80f5-5d9de1ee74ab/_apis/Identities/477f43cf-ff4e-48a5-973d-d0b03bbb35ac","_links":{"avatar":{"href":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"}},"id":"477f43cf-ff4e-48a5-973d-d0b03bbb35ac","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi","descriptor":"aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"},"createdOn":"2020-10-08T20:49:11.930Z","modifiedBy":{"displayName":"Joe Campbell","url":"https://spsprodcus2.vssps.visualstudio.com/A5a6858c3-4eb7-4a0c-80f5-5d9de1ee74ab/_apis/Identities/477f43cf-ff4e-48a5-973d-d0b03bbb35ac","_links":{"avatar":{"href":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"}},"id":"477f43cf-ff4e-48a5-973d-d0b03bbb35ac","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi","descriptor":"aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"},"modifiedOn":"2020-10-08T20:49:11.930Z","isDeleted":false,"lastRelease":{"id":1,"name":"Release-1","artifacts":[],"_links":{},"description":"Triggered by aksdevpoc - CI 20201008.1.","releaseDefinition":{"id":1,"projectReference":null,"_links":{}},"createdOn":"2020-10-08T20:51:14.440Z","createdBy":{"displayName":"Joe Campbell","url":"https://spsprodcus2.vssps.visualstudio.com/A5a6858c3-4eb7-4a0c-80f5-5d9de1ee74ab/_apis/Identities/477f43cf-ff4e-48a5-973d-d0b03bbb35ac","_links":{"avatar":{"href":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"}},"id":"477f43cf-ff4e-48a5-973d-d0b03bbb35ac","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi","descriptor":"aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"}},"variables":{},"variableGroups":[],"environments":[{"id":1,"name":"dev","rank":1,"owner":{"displayName":"Joe Campbell","url":"https://spsprodcus2.vssps.visualstudio.com/A5a6858c3-4eb7-4a0c-80f5-5d9de1ee74ab/_apis/Identities/477f43cf-ff4e-48a5-973d-d0b03bbb35ac","_links":{"avatar":{"href":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"}},"id":"477f43cf-ff4e-48a5-973d-d0b03bbb35ac","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/campbellj0/_apis/GraphProfile/MemberAvatars/aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi","descriptor":"aad.YTVkYTNhMGUtZWYxZC03NTE2LWIxODUtZDMzOTUyNjYzYzZi"},"variables":{"ServicePrincipalId":{"value":"2e0ebb02-c516-42ce-bd1b-0deb7acca3de"},"ServicePrincipalKey":{"value":null,"isSecret":true},"dockerAuthSecretName":{"value":"aksdevpocdockerauth"},"namespace":{"value":"dev670d"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":1}]},"deployStep":{"id":2},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3}]},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-16.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":27,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Run on agent","refName":null,"workflowTasks":[{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"1.*","name":"Azure CLI: Preserve Cluster Tags","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"a1beeaf6-0868-4096-9957-c3124860fd61","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"#!/bin/bash\nexport clusterTags=$(az aks show -n aksdevpoc -g aksdevpoc-rg -o json --query tags || echo \"\")\n\npython -c \"exec(\\\"import sys, json, os;\\nclusterTags=os.environ['clusterTags']\\ndevopsTag='hidden-DevOpsInfo:createdByDevOps;347b8adc-2d0b-4084-b377-827d596bf984_d5229ca7-3253-4f8e-822d-a5bcac0c9fa3_$(Release.DefinitionId);'\\nif clusterTags == '':\\n  clusterTagObject={devopsTag:''}\\nelse:\\n  clusterTagObject=json.loads(clusterTags)\\n  devopsTagPresent=False;\\n  for (k, v) in clusterTagObject.items():\\n    if 'hidden-DevOpsInfo:createdByDevOps;'.lower() in k.lower():\\n      devopsTagPresent=True;\\n  if devopsTagPresent is False:\\n    clusterTagObject[devopsTag]='';\\n\\nprint '##vso[task.setvariable variable=clusterTags;]%s' % json.dumps(clusterTagObject)\\\")\"","args":"","cwd":"","failOnStandardError":"false"}},{"environment":{},"taskId":"94a74903-f93f-4075-884f-dc11f34058b4","version":"2.*","name":"Azure Deployment:Create AKS cluster","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"a1beeaf6-0868-4096-9957-c3124860fd61","action":"Create Or Update Resource Group","resourceGroupName":"aksdevpoc-rg","location":"East US","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/**/aks-template.json","csmParametersFile":"","overrideParameters":"-clusterName \"aksdevpoc\" -dnsPrefix \"aksdevpoc\" -appInsightsLocation \"East US\" -clusterLocation \"East US\" -servicePrincipalClientId \"$(ServicePrincipalId)\" -servicePrincipalClientSecret \"$(ServicePrincipalKey)\" -agentCount 3 -agentVMSize Standard_DS1_v2 -kubernetesVersion 1.16.13 -omsLocation \"East US\" -clusterTags $(clusterTags) -omsWorkspaceName \"aksdevpocfb85\" -httpApplicationRoutingEnabled false","deploymentMode":"Incremental","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","runAgentServiceAsUser":"false","userName":"","password":"","outputVariable":"","deploymentOutputs":"deploymentOutputs"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Extract Resource Information","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"$deploymentOutputs=(ConvertFrom-Json '$(deploymentOutputs)')\n\n$aiKey=$deploymentOutputs.aiKey.value\nWrite-Host \"##vso[task.setvariable variable=aiKey;]$aiKey\"","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","workingDirectory":""}},{"environment":{},"taskId":"cbc316a2-586f-4def-be79-488a1f503564","version":"1.*","name":"kubectl create namespace","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectionType":"Azure Resource Manager","kubernetesServiceEndpoint":"","azureSubscriptionEndpoint":"a1beeaf6-0868-4096-9957-c3124860fd61","azureResourceGroup":"aksdevpoc-rg","kubernetesCluster":"aksdevpoc","namespace":"$(namespace)","command":"apply","useConfigurationFile":"true","configurationType":"inline","configuration":"","inline":"kind: Namespace\napiVersion: v1\nmetadata:\n  name: $(namespace)\nspec: {}\nstatus: {}","arguments":"","secretType":"dockerRegistry","secretArguments":"","containerRegistryType":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpointForSecrets":"","azureContainerRegistry":"","secretName":"","forceUpdate":"true","configMapName":"","forceUpdateConfigMap":"false","useConfigMapFile":"false","configMapFile":"","configMapArguments":"","versionOrLocation":"version","versionSpec":"1.16.13","checkLatest":"false","specifyLocation":"","cwd":"$(System.DefaultWorkingDirectory)","outputFormat":"json"}},{"environment":{},"taskId":"cbc316a2-586f-4def-be79-488a1f503564","version":"1.*","name":"kubectl set imagePullSecrets","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectionType":"Azure Resource Manager","kubernetesServiceEndpoint":"","azureSubscriptionEndpoint":"a1beeaf6-0868-4096-9957-c3124860fd61","azureResourceGroup":"aksdevpoc-rg","kubernetesCluster":"aksdevpoc","namespace":"$(namespace)","command":"get","useConfigurationFile":"false","configuration":"","arguments":"service","secretType":"dockerRegistry","secretArguments":"","containerRegistryType":"Azure Container Registry","dockerRegistryEndpoint":"","azureSubscriptionEndpointForSecrets":"a1beeaf6-0868-4096-9957-c3124860fd61","azureContainerRegistry":"aksdevpocacr.azurecr.io","secretName":"$(dockerAuthSecretName)","forceUpdate":"true","configMapName":"","forceUpdateConfigMap":"false","useConfigMapFile":"false","configMapFile":"","configMapArguments":"","versionOrLocation":"version","versionSpec":"1.16.13","checkLatest":"false","specifyLocation":"","cwd":"$(System.DefaultWorkingDirectory)","outputFormat":"json"}},{"environment":{},"taskId":"068d5909-43e6-48c5-9e01-7c8a94816220","version":"0.*","name":"Install Helm 3.*.*","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"helmVersion":"3.0.2","installKubeCtl":"true","kubectlVersion":"1.10.3","checkLatestKubeCtl":"false","checkLatestHelmVersion":"false"}},{"environment":{},"taskId":"afa7d54d-537b-4dc8-b60a-e0eeea2c9a87","version":"0.*","name":"Helm upgrade","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":null,"overrideInputs":{},"inputs":{"connectionType":"Azure Resource Manager","azureSubscriptionEndpoint":"a1beeaf6-0868-4096-9957-c3124860fd61","azureResourceGroup":"aksdevpoc-rg","kubernetesCluster":"aksdevpoc","kubernetesServiceEndpoint":"","namespace":"$(namespace)","command":"upgrade","chartType":"FilePath","chartName":"","chartPath":"$(System.DefaultWorkingDirectory)/**/sampleapp-*.tgz","version":"","releaseName":"azuredevops","overrideValues":"","valueFile":"","destination":"","canaryimage":"false","upgradetiller":"false","updatedependency":"false","save":"true","install":"true","recreate":"false","resetValues":"false","force":"true","waitForExecution":"true","arguments":"--set image.repository=aksdevpocacr.azurecr.io/aksdevpoc79e5 --set image.tag=$(Build.BuildId)  --set applicationInsights.InstrumentationKey=$(aiKey) --set imagePullSecrets={$(dockerAuthSecretName)} --timeout 900s","tillernamespace":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":false,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":1,"url":"https://vsrm.dev.azure.com/campbellj0/d5229ca7-3253-4f8e-822d-a5bcac0c9fa3/_apis/Release/releases/1","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/campbellj0/_apis/public/Release/badge/d5229ca7-3253-4f8e-822d-a5bcac0c9fa3/1/1"}],"artifacts":[{"sourceId":"d5229ca7-3253-4f8e-822d-a5bcac0c9fa3:2","type":"Build","alias":"Drop","definitionReference":{"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"2","name":"2"},"project":{"id":"d5229ca7-3253-4f8e-822d-a5bcac0c9fa3","name":"aksdevpoc"},"artifactSourceDefinitionUrl":{"id":"https://dev.azure.com/campbellj0/_permalink/_build/index?collectionId=347b8adc-2d0b-4084-b377-827d596bf984&projectId=d5229ca7-3253-4f8e-822d-a5bcac0c9fa3&definitionId=2","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[{"artifactAlias":"Drop","triggerConditions":[],"triggerType":1}],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"PortalExtension "}},"id":1,"name":"aksdevpoc - CD","path":"\\","projectReference":null,"url":"https://vsrm.dev.azure.com/campbellj0/d5229ca7-3253-4f8e-822d-a5bcac0c9fa3/_apis/Release/definitions/1","_links":{"self":{"href":"https://vsrm.dev.azure.com/campbellj0/d5229ca7-3253-4f8e-822d-a5bcac0c9fa3/_apis/Release/definitions/1"},"web":{"href":"https://dev.azure.com/campbellj0/d5229ca7-3253-4f8e-822d-a5bcac0c9fa3/_release?definitionId=1"}}}