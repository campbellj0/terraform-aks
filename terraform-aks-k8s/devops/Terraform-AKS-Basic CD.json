{"source":2,"revision":2,"description":null,"createdBy":{"displayName":"Joe Campbell","url":"https://spsprodcus4.vssps.visualstudio.com/A6a3d5e34-bb53-461e-95b2-fa465f36a3d9/_apis/Identities/7b8484e1-9c42-47e1-a4e1-8c7abebfd513","_links":{"avatar":{"href":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"}},"id":"7b8484e1-9c42-47e1-a4e1-8c7abebfd513","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh","descriptor":"msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"},"createdOn":"2020-10-18T18:37:36.080Z","modifiedBy":{"displayName":"Joe Campbell","url":"https://spsprodcus4.vssps.visualstudio.com/A6a3d5e34-bb53-461e-95b2-fa465f36a3d9/_apis/Identities/7b8484e1-9c42-47e1-a4e1-8c7abebfd513","_links":{"avatar":{"href":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"}},"id":"7b8484e1-9c42-47e1-a4e1-8c7abebfd513","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh","descriptor":"msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"},"modifiedOn":"2020-10-18T22:43:12.843Z","isDeleted":false,"lastRelease":{"id":5,"name":"Release-4","artifacts":[],"_links":{},"description":"","releaseDefinition":{"id":2,"projectReference":null,"_links":{}},"createdOn":"2020-10-18T23:46:38.390Z","createdBy":{"displayName":"Joe Campbell","url":"https://spsprodcus4.vssps.visualstudio.com/A6a3d5e34-bb53-461e-95b2-fa465f36a3d9/_apis/Identities/7b8484e1-9c42-47e1-a4e1-8c7abebfd513","_links":{"avatar":{"href":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"}},"id":"7b8484e1-9c42-47e1-a4e1-8c7abebfd513","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh","descriptor":"msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"}},"variables":{"storagekey":{"value":"PipelineWillGetThisValueRuntime"},"terraformstorageaccount":{"value":"terraformstorage81ab12gh"},"terraformstoragerg":{"value":"rg-terraform-aks-basic"}},"variableGroups":[],"environments":[{"id":2,"name":"Dev","rank":1,"owner":{"displayName":"Joe Campbell","url":"https://spsprodcus4.vssps.visualstudio.com/A6a3d5e34-bb53-461e-95b2-fa465f36a3d9/_apis/Identities/7b8484e1-9c42-47e1-a4e1-8c7abebfd513","_links":{"avatar":{"href":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"}},"id":"7b8484e1-9c42-47e1-a4e1-8c7abebfd513","uniqueName":"joseph.campbell2@gmail.com","imageUrl":"https://dev.azure.com/josephcampbell2/_apis/GraphProfile/MemberAvatars/msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh","descriptor":"msa.YjlhNDI1OWQtYjdlMy03NzE1LWJmMTgtODI2OWUxNjI5MzNh"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":4}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":5},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":6}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2019"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":36,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"1.*","name":"Azure CLI to deploy required Azure resources","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"1c460254-e23d-4e0f-8842-71569bac741a","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"# this will create Azure resource group\ncall az group create --location eastus --name $(terraformstoragerg)\n\ncall az storage account create --name $(terraformstorageaccount) --resource-group $(terraformstoragerg) --location eastus --sku Standard_LRS\n\ncall az storage container create --name terraform --account-name $(terraformstorageaccount)\n\ncall az storage account keys list -g $(terraformstoragerg) -n $(terraformstorageaccount)\n\n","args":"","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false"}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"Azure PowerShell script to get the storage key","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"1c460254-e23d-4e0f-8842-71569bac741a","ScriptType":"InlineScript","ScriptPath":"","Inline":"# Using this script we will fetch storage key which is required in terraform file to authenticate backend storage account\n\n$key=(Get-AzureRmStorageAccountKey -ResourceGroupName $(terraformstoragerg) -AccountName $(terraformstorageaccount)).Value[0]\n\nWrite-Host \"##vso[task.setvariable variable=storagekey]$key\"","ScriptArguments":"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":""}},{"environment":{},"taskId":"a8515ec8-7254-4ffd-912c-86772e2b5962","version":"3.*","name":"Replace tokens in terraform file","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"rootDirectory":"","targetFiles":"**/*.tf","encoding":"auto","writeBOM":"true","escapeType":"none","escapeChar":"","charsToEscape":"","verbosity":"normal","actionOnMissing":"warn","keepToken":"false","tokenPrefix":"__","tokenSuffix":"__","useLegacyPattern":"false","emptyValue":"(empty)","variableFiles":"","variableSeparator":".","enableTelemetry":"true"}},{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 0.12.3","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"0.12.3"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform : init","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/_Terraform-AKS-Basic Build/drop/terraform","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"1c460254-e23d-4e0f-8842-71569bac741a","backendAzureRmResourceGroupName":"$(terraformstoragerg)","backendAzureRmStorageAccountName":"$(terraformstorageaccount) ","backendAzureRmContainerName":"terraform","backendAzureRmKey":"terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform : plan","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"$(System.DefaultWorkingDirectory)/_Terraform-AKS-Basic Build/drop/terraform","commandOptions":"","environmentServiceNameAzureRM":"1c460254-e23d-4e0f-8842-71569bac741a","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"$(terraformstoragerg)","backendAzureRmStorageAccountName":"$(terraformstorageaccount) ","backendAzureRmContainerName":"terraform","backendAzureRmKey":"$(storagekey)","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform : apply -auto-approve","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/_Terraform-AKS-Basic Build/drop/terraform","commandOptions":"-auto-approve","environmentServiceNameAzureRM":"1c460254-e23d-4e0f-8842-71569bac741a","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"$(terraformstoragerg)","backendAzureRmStorageAccountName":"$(terraformstorageaccount) ","backendAzureRmContainerName":"terraform","backendAzureRmKey":"$(storagekey)","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":5,"url":"https://vsrm.dev.azure.com/josephcampbell2/65aa240d-8555-43eb-a2b5-517f24368a99/_apis/Release/releases/5","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/josephcampbell2/_apis/public/Release/badge/65aa240d-8555-43eb-a2b5-517f24368a99/2/2"}],"artifacts":[{"sourceId":"65aa240d-8555-43eb-a2b5-517f24368a99:4","type":"Build","alias":"_Terraform-AKS-Basic Build","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://dev.azure.com/josephcampbell2/_permalink/_build/index?collectionId=f2fbdcad-4754-4b2c-8dfa-fa5fa28df3e0&projectId=65aa240d-8555-43eb-a2b5-517f24368a99&definitionId=4","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"4","name":"Terraform-AKS-Basic Build"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"65aa240d-8555-43eb-a2b5-517f24368a99","name":"terraform-aks"},"repository":{"id":"","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseClone"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"}},"id":2,"name":"Terraform-AKS-Basic CD","path":"\\","projectReference":null,"url":"https://vsrm.dev.azure.com/josephcampbell2/65aa240d-8555-43eb-a2b5-517f24368a99/_apis/Release/definitions/2","_links":{"self":{"href":"https://vsrm.dev.azure.com/josephcampbell2/65aa240d-8555-43eb-a2b5-517f24368a99/_apis/Release/definitions/2"},"web":{"href":"https://dev.azure.com/josephcampbell2/65aa240d-8555-43eb-a2b5-517f24368a99/_release?definitionId=2"}}}